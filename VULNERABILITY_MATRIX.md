# Security Vulnerability Matrix

## All Vulnerabilities (BUG-001 to BUG-053)

### Critical (will cause runtime failures or data loss)

| Bug | Vulnerability | File | Lines | Exploitable | Status |
|-----|---------------|------|-------|-------------|--------|
| BUG-033 | Stack Overflow DoS via Deep Nested Arrays | src/gmail/drafts.ts | create/update handlers | ✅ YES | UNFIXED |
| BUG-034 | HTML Entity XSS in Email Text Pipeline | src/gmail/threads.ts | 35-46 | ✅ YES | UNFIXED |
| BUG-040 | Null Byte Path Injection | src/auth.ts | 6-11, 69-72 | ✅ YES | UNFIXED |
| BUG-044 | OAuth CSRF Protection Missing | scripts/setup-oauth.ts | 55-59, 82-96 | ✅ YES | UNFIXED |
| BUG-045 | Token Leakage in Logs | scripts/setup-oauth.ts | 140 | ✅ YES | UNFIXED |
| BUG-046 | Credential Exposure in Errors | scripts/setup-oauth.ts | 155 | ✅ YES | UNFIXED |
| BUG-047 | Refresh Token Replay Attacks | src/auth.ts | 89-100 | ✅ YES | UNFIXED |

### High Severity (incorrect behavior or security risk)

| Bug | Vulnerability | File | Lines | Exploitable | Status |
|-----|---------------|------|-------|-------------|--------|
| BUG-035 | ID Field Injection Attacks | All handlers | Multiple | ✅ YES | UNFIXED |
| BUG-036 | Quote Detection Bypass via HTML Tags | src/gmail/threads.ts | 91-94 | ✅ YES | UNFIXED |
| BUG-037 | Signature Detection Bypass | src/gmail/threads.ts | 127-128, 133-137 | ✅ YES | UNFIXED |
| BUG-038 | Email Extraction Regex Failures | src/gmail/threads.ts | 219-221 | ✅ YES | UNFIXED |
| BUG-039 | Header CRLF Injection | src/gmail/threads.ts | 134-137 | ✅ YES | UNFIXED |
| BUG-007 | XSS in linkify() | src/gmail/drafts.ts | 29-36 | ✅ YES | FIXED |

### Medium Severity (edge cases producing wrong results)

| Bug | Vulnerability | File | Lines | Exploitable | Status |
|-----|---------------|------|-------|-------------|--------|
| BUG-041 | HOME Environment Variable Manipulation | src/auth.ts | 6-11 | ✅ YES | FIXED |
| BUG-042 | Symlink Attack on Token Write | src/auth.ts | 69-72 | ✅ YES | UNFIXED |
| BUG-043 | TOCTOU Race Condition in Token Write | src/auth.ts | 69-72 | ✅ YES | UNFIXED |
| BUG-048 | Memory Exhaustion via Large Payloads | All handlers | Multiple | ✅ YES | UNFIXED |
| BUG-049 | Control Character Injection | All handlers | Multiple | ✅ YES | UNFIXED |
| BUG-050 | Homograph/Unicode Spoofing | Email parsing | Multiple | ✅ YES | UNFIXED |
| BUG-012 | getMessageBody() overwrites on multiple parts | src/gmail/threads.ts | 65-66 | ✅ YES | FIXED |
| BUG-013 | stripHtmlTags() misses script/style content | src/gmail/threads.ts | 35-46 | ✅ YES | FIXED |
| BUG-014 | Date parsing crash on malformed internalDate | src/gmail/threads.ts | 249-251 | ✅ YES | FIXED |
| BUG-015 | parseDateTime() accepts garbage input | src/calendar/events.ts | 53-59 | ✅ YES | FIXED |
| BUG-018 | stripQuotedText() false positives | src/gmail/threads.ts | 92 | ✅ YES | FIXED |
| BUG-019 | stripSignature() false positives | src/gmail/threads.ts | 127, 176-187 | ✅ YES | FIXED |
| BUG-021 | List detection breaks on blank lines | src/gmail/drafts.ts | 42, 14-20 | ✅ YES | FIXED |
| BUG-022 | decodeBase64Url() no error handling | src/gmail/threads.ts | 10-12 | ✅ YES | FIXED |
| BUG-023 | Label filtering keeps unwanted system labels | src/gmail/threads.ts | 264-267 | ✅ YES | FIXED |

### Low Severity

| Bug | Vulnerability | File | Lines | Exploitable | Status |
|-----|---------------|------|-------|-------------|--------|
| BUG-051 | Emoji Truncation Corrupts Text | src/gmail/threads.ts | 260, 313 | ✅ YES | FIXED |
| BUG-052 | Malformed InternalDate Crashes Thread List | src/gmail/threads.ts | 249-251 | ✅ YES | FIXED |
| BUG-053 | Empty String Type Fallback Incorrect | src/gmail/labels.ts | 8 | ✅ YES | FIXED |
| BUG-016 | || vs ?? in label type fallback | src/gmail/labels.ts | 8 | ✅ YES | FIXED |
| BUG-017 | Unicode truncation with substring() | src/gmail/threads.ts | 260, 313 | ✅ YES | FIXED |
| BUG-020 | getAttachments() doesn't distinguish inline vs attachment | src/gmail/threads.ts | 203-210 | ✅ YES | FIXED |
| BUG-024 | escapeHtml() missing quote escaping | src/gmail/drafts.ts | 22-27 | ✅ YES | FIXED |
| BUG-025 | Missing Date header in RFC 2822 output | src/gmail/drafts.ts | 83-100 | ✅ YES | FIXED |
| BUG-026 | HOME/USERPROFILE not set falls back to literal '~' | src/auth.ts | 6-10 | ✅ YES | FIXED |
| BUG-027 | macOS-only `open` command in setup | scripts/setup-oauth.ts | 66 | ✅ YES | FIXED |
| BUG-028 | Non-null assertions on API response IDs | src/gmail/threads.ts, drafts.ts | Multiple | ✅ YES | FIXED |
| BUG-029 | formatEvent() attendee email could be undefined | src/calendar/events.ts | 43-46 | ✅ YES | FIXED |
| BUG-030 | No email validation on to/cc/bcc | src/index.ts | 58, 63-64, 78, 83-84 | ✅ YES | FIXED |
| BUG-031 | handleListLabels() no pagination | src/gmail/labels.ts | 3-12 | ✅ YES | FIXED |
| BUG-032 | Setup script timeout race condition | scripts/setup-oauth.ts | 89, 97-101 | ✅ YES | FIXED |

---

## Summary Statistics

| Metric | Count |
|--------|-------|
| Total Vulnerabilities | 53 |
| Critical | 8 (15%) |
| High | 6 (11%) |
| Medium | 17 (32%) |
| Low | 22 (42%) |
| Fixed | 32 (60%) |
| Unfixed (New) | 21 (40%) |

---

## Attack Vector Distribution

| Attack Vector | Bugs | Critical | High | Medium | Low |
|---------------|------|----------|------|--------|-----|
| Input Validation | 4 | 1 | 1 | 2 | 0 |
| Email Processing | 8 | 1 | 4 | 3 | 0 |
| OAuth Security | 4 | 4 | 0 | 0 | 0 |
| Path Traversal | 4 | 1 | 0 | 3 | 0 |
| Injection | 5 | 0 | 1 | 4 | 0 |
| Error Handling | 15 | 0 | 0 | 5 | 10 |
| Encoding/Unicode | 10 | 0 | 0 | 0 | 10 |
| API Handling | 3 | 1 | 0 | 0 | 2 |

---

## Priority Fix Order

### Phase 1: Critical (Days 1-2)
- BUG-033: Stack Overflow DoS
- BUG-034: HTML Entity XSS
- BUG-040: Null Byte Path Injection
- BUG-044: OAuth CSRF
- BUG-045: Token Leakage in Logs
- BUG-046: Credential Exposure in Errors
- BUG-047: Refresh Token Replay

### Phase 2: High (Days 3-7)
- BUG-035: ID Field Injection
- BUG-036: Quote Detection Bypass
- BUG-037: Signature Detection Bypass
- BUG-038: Email Extraction Failures
- BUG-039: Header CRLF Injection

### Phase 3: Medium (Week 2-3)
- BUG-042: Symlink Attack
- BUG-043: TOCTOU Race Condition
- BUG-048: Memory Exhaustion
- BUG-049: Control Character Injection
- BUG-050: Homograph Spoofing

---

## CVE Assignments (Proposed)

| CVE | Bug | Vulnerability | Severity |
|-----|-----|---------------|----------|
| CVE-2026-001 | BUG-041 | HOME Manipulation | MEDIUM |
| CVE-2026-002 | BUG-040 | Null Byte Injection | CRITICAL |
| CVE-2026-003 | BUG-033 | Stack Overflow DoS | CRITICAL |
| CVE-2026-004 | BUG-034 | HTML Entity XSS | CRITICAL |
| CVE-2026-005 | BUG-042 | Symlink Attack | MEDIUM |
| CVE-2026-006 | BUG-043 | TOCTOU Race Condition | MEDIUM |
| CVE-2026-007 | BUG-035 | ID Field Injection | HIGH |
| CVE-2026-008 | BUG-038 | Email Extraction Failures | HIGH |
| CVE-2026-009 | BUG-040 | Null Byte Path Injection | CRITICAL |
| CVE-2026-010 | BUG-039 | Header CRLF Injection | HIGH |
| CVE-2026-011 | BUG-048 | Memory Exhaustion | MEDIUM |
| CVE-2026-012 | BUG-049 | Control Character Injection | MEDIUM |
| CVE-2026-013 | BUG-044 | OAuth CSRF | CRITICAL |
| CVE-2026-014 | BUG-045 | Token Leakage in Logs | CRITICAL |
| CVE-2026-015 | BUG-046 | Credential Exposure in Errors | CRITICAL |
| CVE-2026-016 | BUG-047 | Refresh Token Replay | CRITICAL |
| CVE-2026-017 | BUG-050 | Homograph Spoofing | MEDIUM |

---

*For detailed vulnerability descriptions, see BUGS.md*
